<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>SETEC POS</title>
  <!-- Fonts -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/source-sans-3@5.0.12/index.css" integrity="sha256-tXJfXfp6Ewt1ilPzLDtQnJV4hclT9XuaZUKyUvmyr+Q=" crossorigin="anonymous" />
  <!-- Third Party Plugins -->
  <link rel="stylesheet" href="overlayscrollbars.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" integrity="sha256-9kPW/n5nn53j4WMRYAxe9c1rCY96Oogo/MKSVdKzPmI=" crossorigin="anonymous" />
  <!-- Admin CSS -->
  <link rel="stylesheet" href="admin.css">
</head>
<body class="layout-fixed sidebar-expand-lg bg-body-tertiary">
  <div class="app-wrapper">
    <aside class="app-sidebar bg-body-secondary shadow" data-bs-theme="dark">
      <div class="sidebar-brand">
        <a href="index.html" class="brand-link">
          <img src="logo.png" class="brand-image opacity-75 shadow">
          <!-- <span class="brand-text fw-light">SETEC POS</span> -->
        </a>
      </div>
      <div class="sidebar-wrapper">
        <nav class="mt-2">
          <ul class="nav sidebar-menu flex-column" data-lte-toggle="treeview" role="menu" data-accordion="false">
            <li class="nav-item">
              <a href="#" class="nav-link" onclick="showSection('dashboard')">
                <i class="nav-icon fa-solid fa-gauge-high"></i>
                <p>Dashboard</p>
              </a>
            </li>
            <li class="nav-item">
              <a href="#" class="nav-link">
                <i class="nav-icon fa-solid fa-box-open"></i>
                <p>
                  Products
                  <i class="nav-arrow bi bi-chevron-right"></i>
                </p>
              </a>
              <ul class="nav nav-treeview">
                <li class="nav-item">
                  <a href="#" class="nav-link" onclick="showSection('addProduct')">
                    <i class="nav-icon bi bi-circle"></i>
                    <p>Add Product</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="#" class="nav-link" onclick="showSection('listProduct')">
                    <i class="nav-icon bi bi-circle"></i>
                    <p>List Products</p>
                  </a>
                </li>
              </ul>
            </li>
            <li class="nav-item">
              <a href="#" class="nav-link">
                <i class="nav-icon fa-solid fa-layer-group"></i>
                <p>
                  Categories
                  <i class="nav-arrow bi bi-chevron-right"></i>
                </p>
              </a>
              <ul class="nav nav-treeview">
                <li class="nav-item">
                  <a href="#" class="nav-link" onclick="showSection('addCategory')">
                    <i class="nav-icon bi bi-circle"></i>
                    <p>Add Category</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="#" class="nav-link" onclick="showSection('listCategory')">
                    <i class="nav-icon bi bi-circle"></i>
                    <p>List Categories</p>
                  </a>
                </li>
              </ul>
            </li>
            <li class="nav-item">
              <a href="#" class="nav-link">
                <i class="nav-icon bi bi-cart4"></i>
                <p>
                  Orders
                  <i class="nav-arrow bi bi-chevron-right"></i>
                </p>
              </a>
              <ul class="nav nav-treeview">
                <li class="nav-item">
                  <a href="#" class="nav-link" onclick="showSection('addOrder')">
                    <i class="nav-icon bi bi-circle"></i>
                    <p>Add Order</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="#" class="nav-link" onclick="showSection('listOrders')">
                    <i class="nav-icon bi bi-circle"></i>
                    <p>List Orders</p>
                  </a>
                </li>
              </ul>
            </li>
            <li class="nav-item">
              <a href="#" class="nav-link">
                <i class="nav-icon bi bi-people-fill"></i>
                <p>
                  Users
                  <i class="nav-arrow bi bi-chevron-right"></i>
                </p>
              </a>
              <ul class="nav nav-treeview">
                <li class="nav-item">
                  <a href="#" class="nav-link" onclick="showSection('addUser')">
                    <i class="nav-icon bi bi-circle"></i>
                    <p>Add Users</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="#" class="nav-link" onclick="showSection('listUsers')">
                    <i class="nav-icon bi bi-circle"></i>
                    <p>List Users</p>
                  </a>
                </li>
              </ul>
            </li>
            <li class="nav-item">
              <a href="#" class="nav-link" onclick="showSection('sitting')">
                <i class="nav-icon bi bi-gear-fill"></i>
                <p>Sitting</p>
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </aside>

    <main class="app-main">

      <!-- DASHBOARD SECTION -->
      <div class="app-content" id="dashboard" style="display:block; margin-top: 30px;" >
        <div class="container-fluid">
          <div class="row">
            <div class="col-lg-3 col-6">
              <div class="small-box text-bg-primary">
                <div class="inner">
                  <h3 id="productCount">0</h3>
                  <p>Products</p>
                </div>
                <div class="icon">
                  <i class="fa-solid fa-th-large"></i>
                </div>
              </div>
            </div>
            <div class="col-lg-3 col-6">
              <div class="small-box text-bg-success">
                <div class="inner">
                  <h3 id="orderCount">0</h3>
                  <p>Orders</p>
                </div>
                <div class="icon">
                  <i class="bi bi-cart4"></i>
                </div>
              </div>
            </div>
            <div class="col-lg-3 col-6">
              <div class="small-box text-bg-warning">
                <div class="inner">
                  <h3 id="categoryCount">0</h3>
                  <p>Categories</p>
                </div>
                <div class="icon">
                  <i class="fa-solid fa-box-open"></i>
                </div>
              </div>
            </div>
            <div class="col-lg-3 col-6">
              <div class="small-box text-bg-danger">
                <div class="inner">
                  <h3 id="userCount">0</h3>
                  <p>Users</p>
                </div>
                <div class="icon">
                  <i class="bi bi-people-fill"></i>
                </div>
              </div>
            </div>
          </div>

          <div class="mt-4">
            <h3>Products Overview</h3>
            <table class="table table-bordered table-striped" id="dashboardProductTable">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Product Name</th>
                  <th>Price</th>
                  <th>Qty</th>
                  <th>Category</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <div class="mt-4">
            <h3>Categories Overview</h3>
            <table class="table table-bordered table-striped" id="dashboardCategoryTable">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Category Name</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <div class="mt-4">
            <h3>Orders Overview</h3>
            <table class="table table-bordered table-striped" id="dashboardOrderTable">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Order Name</th>
                  <th>QTY</th>
                  <th>Date</th>
                  <th>Product</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <div class="mt-4">
            <h3>Users Overview</h3>
            <table class="table table-bordered table-striped" id="dashboardUserTable">
              <thead>
                <tr>
                  <th>#</th>
                  <th>User Name</th>
                  <th>Email</th>
                  <th>Phone</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
      <!-- END DASHBOARD SECTION -->

      <!-- ADD PRODUCT SECTION -->
      <div class="app-content" id="addProduct" style="display:none; margin-top: 30px;">
        <div class="container-fluid">
          <h2>Add Product</h2>
          <input type="hidden" id="editProductIndex" value="-1" />
          <form onsubmit="handleProductForm(event)">
            <input type="text" id="productName" class="form-control mb-2" placeholder="Product Name" required>
            <input type="number" id="productPrice" class="form-control mb-2" placeholder="Price" required>
            <input type="number" id="productQty" class="form-control mb-2" placeholder="Quantity" required>
            <select id="category" class="form-control mb-2" required>
              <option value="">Select Category</option>
            </select>
            <textarea id="productDesc" class="form-control mb-2" placeholder="Description"></textarea>
            <button type="submit" class="btn btn-primary" id="productBtn">Save Product</button>
          </form>

          <h3 class="mt-4">List Products</h3>
          <table class="table table-bordered table-striped" id="productTable">
            <thead>
              <tr>
                <th>#</th>
                <th>Product Name</th>
                <th>Price</th>
                <th>Qty</th>
                <th>Category</th>
                <th>Description</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      <!-- END ADD PRODUCT SECTION -->

      <!-- LIST PRODUCT SECTION -->
      <div class="app-content" id="listProduct" style="display:none; margin-top: 30px;">
        <div class="container-fluid">
          <h2>Product List</h2>
          <table class="table table-bordered table-striped" id="productTable2">
            <thead>
              <tr>
                <th>#</th>
                <th>Product Name</th>
                <th>Price</th>
                <th>Qty</th>
                <th>Category</th>
                <th>Description</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      <!-- END LIST PRODUCT SECTION -->

      <!-- ADD CATEGORY SECTION -->
      <div class="app-content" id="addCategory" style="display:none; margin-top: 30px;">
        <div class="container-fluid">
          <h2>Add Category</h2>
          <input type="hidden" id="editCategoryIndex" value="-1" />
          <form onsubmit="handleCategoryForm(event)">
            <input type="text" id="categoryName" class="form-control mb-2" placeholder="Category Name" required>
            <button type="submit" class="btn btn-primary" id="categoryBtn">Save Category</button>
          </form>

          <h3 class="mt-4">List Categories</h3>
          <table class="table table-bordered table-striped" id="categoryTable">
            <thead>
              <tr>
                <th>#</th>
                <th>Category Name</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      <!-- END ADD CATEGORY SECTION -->

      <!-- LIST CATEGORY SECTION -->
      <div class="app-content" id="listCategory" style="display:none; margin-top: 30px;">
        <div class="container-fluid">
          <h2>Category List</h2>
          <table class="table table-bordered table-striped" id="categoryTable2">
            <thead>
              <tr>
                <th>#</th>
                <th>Category Name</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      <!-- END LIST CATEGORY SECTION -->

      <!-- ADD ORDER SECTION -->
      <div class="app-content" id="addOrder" style="display:none; margin-top: 30px;">
        <div class="container-fluid">
          <h2>Add Order</h2>
          <input type="hidden" id="editOrderIndex" value="-1" />
          <form onsubmit="handleOrderForm(event)">
            <input type="text" id="orderName" class="form-control mb-2" placeholder="Order Name" required>
            <input type="number" id="orderqty" class="form-control mb-2" placeholder="Quantity" required>
            <input type="date" id="orderDate" class="form-control mb-2" required>
            <select id="orderProduct" class="form-control mb-2" required>
              <option value="">Select Product</option>
            </select>
            <button type="submit" class="btn btn-primary" id="orderBtn">Save Order</button>
          </form>

          <h3 class="mt-4">List Orders</h3>
          <table class="table table-bordered table-striped" id="orderTable">
            <thead>
              <tr>
                <th>#</th>
                <th>Order Name</th>
                <th>QTY</th>
                <th>Date</th>
                <th>Product</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      <!-- END ADD ORDER SECTION -->

      <!-- LIST ORDER SECTION -->
      <div class="app-content" id="listOrders" style="display:none; margin-top: 30px;">
        <div class="container-fluid">
          <h2>Order List</h2>
          <table class="table table-bordered table-striped" id="orderTable2">
            <thead>
              <tr>
                <th>#</th>
                <th>Order Name</th>
                <th>QTY</th>
                <th>Date</th>
                <th>Product</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      <!-- END LIST ORDER SECTION -->

      <!-- ADD USER SECTION -->
      <div class="app-content" id="addUser" style="display:none; margin-top: 30px;">
        <div class="container-fluid">
          <h2>Add User</h2>
          <input type="hidden" id="editUserIndex" value="-1" />
          <form onsubmit="handleUserForm(event)">
            <input type="text" id="userName" class="form-control mb-2" placeholder="User Name" required>
            <input type="email" id="userEmail" class="form-control mb-2" placeholder="Email" required>
            <input type="text" id="userPhone" class="form-control mb-2" placeholder="Phone">
            <button type="submit" class="btn btn-primary" id="userBtn">Save User</button>
          </form>

          <h3 class="mt-4">List Users</h3>
          <table class="table table-bordered table-striped" id="userTable">
            <thead>
              <tr>
                <th>#</th>
                <th>User Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      <!-- END ADD USER SECTION -->

      <!-- LIST USER SECTION -->
      <div class="app-content" id="listUsers" style="display:none; margin-top: 30px;">
        <div class="container-fluid">
          <h2>User List</h2>
          <table class="table table-bordered table-striped" id="userTable2">
            <thead>
              <tr>
                <th>#</th>
                <th>User Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      <!-- END LIST USER SECTION -->

      <!-- SITTING SECTION -->
      <div class="app-content" id="sitting" style="display:none; margin-top: 30px;">
        <div class="container-fluid">
          <h2>Sitting</h2>
          <p>Some setting here...</p>
        </div>
      </div>
      <!-- END SITTING SECTION -->
    </main>
  </div>

  <!-- Scripts -->
  <script defer src="overlayscrollbars.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
  <script src="admin.js"></script>
  <script>
    (function (global, factory) {
      typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :
      typeof define === 'function' && define.amd ? define(['exports'], factory) :
      (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global.adminlte = {}));
    })(this, (function (exports) { 'use strict';

      const domContentLoadedCallbacks = [];
      const onDOMContentLoaded = (callback) => {
        if (document.readyState === 'loading') {
          if (!domContentLoadedCallbacks.length) {
            document.addEventListener('DOMContentLoaded', () => {
              for (const callback of domContentLoadedCallbacks) {
                callback();
              }
            });
          }
          domContentLoadedCallbacks.push(callback);
        } else {
          callback();
        }
      };

      function setCookie(name, value, days = 365) {
        const date = new Date(); // Fixed from NewDate
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        const expires = "expires=" + date.toUTCString();
        document.cookie = name + "=" + encodeURIComponent(JSON.stringify(value)) + ";" + expires + ";path=/";
      }

      function getCookie(name) {
        const nameEQ = name + "=";
        const ca = document.cookie.split(';');
        for (let i = 0; i < ca.length; i++) {
          let c = ca[i];
          while (c.charAt(0) === ' ') c = c.substring(1, c.length);
          if (c.indexOf(nameEQ) === 0) {
            return JSON.parse(decodeURIComponent(c.substring(nameEQ.length, c.length)));
          }
        }
        return [];
      }

      function initializeData() {
        ["products", "orders", "categories", "users"].forEach(key => {
          if (!document.cookie.includes(key)) {
            setCookie(key, []);
          }
        });
      }

      onDOMContentLoaded(function() {
        initializeData();
        const products = getCookie("products");
        const orders = getCookie("orders");
        const categories = getCookie("categories");
        const users = getCookie("users");

        loadDashboardProducts(products);
        loadDashboardCategories(categories);
        loadDashboardOrders(orders);
        loadDashboardUsers(users);
        updateDashboardCounts(products, orders, categories, users);

        showSection("dashboard");
        updateDropdowns();
      });

      const sections = ["dashboard", "addProduct", "listProduct", "addCategory", "listCategory", 
                       "addOrder", "listOrders", "addUser", "listUsers", "sitting"];

      function showSection(section) {
        sections.forEach(s => {
          const el = document.getElementById(s);
          if (el) el.style.display = s === section ? "block" : "none";
        });

        if (section === "dashboard") {
          const products = getCookie("products");
          const orders = getCookie("orders");
          const categories = getCookie("categories");
          const users = getCookie("users");
          loadDashboardProducts(products);
          loadDashboardCategories(categories);
          loadDashboardOrders(orders);
          loadDashboardUsers(users);
          updateDashboardCounts(products, orders, categories, users);
        }
        if (section === "addProduct") {
          loadProducts();
          updateDropdowns();
        }
        if (section === "listProduct") loadProducts2();
        if (section === "addCategory") loadCategories();
        if (section === "listCategory") loadCategories2();
        if (section === "addOrder") {
          loadOrders();
          updateDropdowns();
        }
        if (section === "listOrders") loadOrders2();
        if (section === "addUser") loadUsers();
        if (section === "listUsers") loadUsers2();
      }

      function updateDashboardCounts(products, orders, categories, users) {
        document.getElementById("productCount").innerText = products.length;
        document.getElementById("orderCount").innerText = orders.length;
        document.getElementById("categoryCount").innerText = categories.length;
        document.getElementById("userCount").innerText = users.length;
      }

      // PRODUCT LOGIC
      function handleProductForm(event) {
        event.preventDefault();
        const idx = parseInt(document.getElementById("editProductIndex").value, 10);
        if (idx >= 0) updateProduct(idx);
        else saveProduct();
      }

      function saveProduct() {
        let products = getCookie("products");
        const product = {
          name: document.getElementById("productName").value,
          price: document.getElementById("productPrice").value,
          qty: parseInt(document.getElementById("productQty").value, 10),
          cat: document.getElementById("category").value,
          desc: document.getElementById("productDesc").value
        };
        products.push(product);
        setCookie("products", products);
        alert("Product Saved");
        resetProductForm();
        loadProducts();
        loadDashboardProducts(products);
        updateDashboardCounts(products, getCookie("orders"), getCookie("categories"), getCookie("users"));
      }

      function loadProducts() {
        const products = getCookie("products");
        const tbody = document.querySelector("#productTable tbody");
        tbody.innerHTML = "";
        products.forEach((p, i) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${i + 1}</td>
            <td>${p.name}</td>
            <td>${p.price}</td>
            <td>${p.qty}</td>
            <td>${p.cat}</td>
            <td>${p.desc}</td>
            <td>
              <button class="btn btn-sm btn-warning" onclick="editProduct(${i})">Edit</button>
              <button class="btn btn-sm btn-danger" onclick="deleteProduct(${i})">Delete</button>
            </td>
          `;
          tbody.appendChild(row);
        });
      }

      function loadProducts2() {
        const products = getCookie("products");
        const tbody = document.querySelector("#productTable2 tbody");
        tbody.innerHTML = "";
        products.forEach((p, i) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${i + 1}</td>
            <td>${p.name}</td>
            <td>${p.price}</td>
            <td>${p.qty}</td>
            <td>${p.cat}</td>
            <td>${p.desc}</td>
            <td>
              <button class="btn btn-sm btn-warning" onclick="editProductInAdd(${i})">Edit</button>
              <button class="btn btn-sm btn-danger" onclick="deleteProduct(${i})">Delete</button>
            </td>
          `;
          tbody.appendChild(row);
        });
      }

      function loadDashboardProducts(products) {
        const tbody = document.querySelector("#dashboardProductTable tbody");
        tbody.innerHTML = "";
        products.forEach((p, i) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${i + 1}</td>
            <td>${p.name}</td>
            <td>${p.price}</td>
            <td>${p.qty}</td>
            <td>${p.cat}</td>
            <td>${p.desc}</td>
          `;
          tbody.appendChild(row);
        });
      }

      function editProduct(index) {
        const products = getCookie("products");
        if (index >= 0 && index < products.length) {
          const p = products[index];
          document.getElementById("productName").value = p.name;
          document.getElementById("productPrice").value = p.price;
          document.getElementById("productQty").value = p.qty;
          document.getElementById("category").value = p.cat;
          document.getElementById("productDesc").value = p.desc;
          document.getElementById("editProductIndex").value = index;
          document.getElementById("productBtn").textContent = "Update Product";
          showSection("addProduct");
        }
      }

      function editProductInAdd(index) {
        editProduct(index);
      }

      function updateProduct(index) {
        let products = getCookie("products");
        if (index >= 0 && index < products.length) {
          products[index] = {
            name: document.getElementById("productName").value,
            price: document.getElementById("productPrice").value,
            qty: parseInt(document.getElementById("productQty").value, 10),
            cat: document.getElementById("category").value,
            desc: document.getElementById("productDesc").value
          };
          setCookie("products", products);
          alert("Product Updated");
          resetProductForm();
          loadProducts();
          loadProducts2();
          loadDashboardProducts(products);
          updateDashboardCounts(products, getCookie("orders"), getCookie("categories"), getCookie("users"));
        } else {
          alert("Invalid product index");
        }
      }

      function deleteProduct(index) {
        if (!confirm("Are you sure you want to delete this product?")) return;
        let products = getCookie("products");
        if (index >= 0 && index < products.length) {
          products.splice(index, 1);
          setCookie("products", products);
          loadProducts();
          loadProducts2();
          loadDashboardProducts(products);
          updateDashboardCounts(products, getCookie("orders"), getCookie("categories"), getCookie("users"));
          alert("Product Deleted");
        } else {
          alert("Invalid product index");
        }
      }

      function resetProductForm() {
        document.getElementById("editProductIndex").value = "-1";
        document.getElementById("productName").value = "";
        document.getElementById("productPrice").value = "";
        document.getElementById("productQty").value = "";
        document.getElementById("category").value = "";
        document.getElementById("productDesc").value = "";
        document.getElementById("productBtn").textContent = "Save Product";
      }

      // CATEGORY LOGIC
      function handleCategoryForm(event) {
        event.preventDefault();
        const idx = parseInt(document.getElementById("editCategoryIndex").value, 10);
        if (idx >= 0) updateCategory(idx);
        else saveCategory();
      }

      function saveCategory() {
        let categories = getCookie("categories");
        const catName = document.getElementById("categoryName").value.trim();
        if (catName && !categories.includes(catName)) {
          categories.push(catName);
          setCookie("categories", categories);
          alert("Category Saved");
          resetCategoryForm();
          loadCategories();
          loadDashboardCategories(categories);
          updateDashboardCounts(getCookie("products"), getCookie("orders"), categories, getCookie("users"));
          updateDropdowns();
        } else {
          alert("Category already exists or invalid!");
        }
      }

      function loadCategories() {
        const categories = getCookie("categories");
        const tbody = document.querySelector("#categoryTable tbody");
        tbody.innerHTML = "";
        categories.forEach((c, i) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${i + 1}</td>
            <td>${c}</td>
            <td>
              <button class="btn btn-sm btn-warning" onclick="editCategory(${i})">Edit</button>
              <button class="btn btn-sm btn-danger" onclick="deleteCategory(${i})">Delete</button>
            </td>
          `;
          tbody.appendChild(row);
        });
      }

      function loadCategories2() {
        const categories = getCookie("categories");
        const tbody = document.querySelector("#categoryTable2 tbody");
        tbody.innerHTML = "";
        categories.forEach((c, i) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${i + 1}</td>
            <td>${c}</td>
            <td>
              <button class="btn btn-sm btn-warning" onclick="editCategoryInAdd(${i})">Edit</button>
              <button class="btn btn-sm btn-danger" onclick="deleteCategory(${i})">Delete</button>
            </td>
          `;
          tbody.appendChild(row);
        });
      }

      function loadDashboardCategories(categories) {
        const tbody = document.querySelector("#dashboardCategoryTable tbody");
        tbody.innerHTML = "";
        categories.forEach((c, i) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${i + 1}</td>
            <td>${c}</td>
          `;
          tbody.appendChild(row);
        });
      }

      function editCategory(index) {
        const categories = getCookie("categories");
        if (index >= 0 && index < categories.length) {
          document.getElementById("categoryName").value = categories[index];
          document.getElementById("editCategoryIndex").value = index;
          document.getElementById("categoryBtn").textContent = "Update Category";
          showSection("addCategory");
        }
      }

      function editCategoryInAdd(index) {
        editCategory(index);
      }

      function updateCategory(index) {
        let categories = getCookie("categories");
        if (index >= 0 && index < categories.length) {
          const newCat = document.getElementById("categoryName").value.trim();
          if (newCat && (!categories.includes(newCat) || categories[index] === newCat)) {
            categories[index] = newCat;
            setCookie("categories", categories);
            alert("Category Updated");
            resetCategoryForm();
            loadCategories();
            loadCategories2();
            loadDashboardCategories(categories);
            updateDashboardCounts(getCookie("products"), getCookie("orders"), categories, getCookie("users"));
            updateDropdowns();
          } else {
            alert("Category already exists or invalid!");
          }
        } else {
          alert("Invalid category index");
        }
      }

      function deleteCategory(index) {
        if (!confirm("Are you sure you want to delete this category?")) return;
        let categories = getCookie("categories");
        if (index >= 0 && index < categories.length) {
          categories.splice(index, 1);
          setCookie("categories", categories);
          loadCategories();
          loadCategories2();
          loadDashboardCategories(categories);
          updateDashboardCounts(getCookie("products"), getCookie("orders"), categories, getCookie("users"));
          updateDropdowns();
          alert("Category Deleted");
        } else {
          alert("Invalid category index");
        }
      }

      function resetCategoryForm() {
        document.getElementById("editCategoryIndex").value = "-1";
        document.getElementById("categoryName").value = "";
        document.getElementById("categoryBtn").textContent = "Save Category";
      }

      // ORDER LOGIC
      function handleOrderForm(event) {
        event.preventDefault();
        const idx = parseInt(document.getElementById("editOrderIndex").value, 10);
        if (idx >= 0) updateOrder(idx);
        else saveOrder();
      }

      function saveOrder() {
        let orders = getCookie("orders");
        let products = getCookie("products");
        const orderProductName = document.getElementById("orderProduct").value;
        const orderQty = parseInt(document.getElementById("orderqty").value, 10);

        const productIndex = products.findIndex(p => p.name === orderProductName);
        if (productIndex === -1) {
          alert("Product not found!");
          return;
        }
        if (products[productIndex].qty < orderQty) {
          alert("Insufficient stock!");
          return;
        }

        products[productIndex].qty -= orderQty;
        const order = {
          name: document.getElementById("orderName").value,
          qty: orderQty,
          date: document.getElementById("orderDate").value,
          product: orderProductName
        };
        orders.push(order);
        setCookie("orders", orders);
        setCookie("products", products);
        alert("Order Saved");
        resetOrderForm();
        loadOrders();
        loadDashboardOrders(orders);
        loadDashboardProducts(products);
        updateDashboardCounts(products, orders, getCookie("categories"), getCookie("users"));
      }

      function loadOrders() {
        const orders = getCookie("orders");
        const tbody = document.querySelector("#orderTable tbody");
        tbody.innerHTML = "";
        orders.forEach((o, i) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${i + 1}</td>
            <td>${o.name}</td>
            <td>${o.qty}</td>
            <td>${o.date}</td>
            <td>${o.product}</td>
            <td>
              <button class="btn btn-sm btn-warning" onclick="editOrder(${i})">Edit</button>
              <button class="btn btn-sm btn-danger" onclick="deleteOrder(${i})">Delete</button>
            </td>
          `;
          tbody.appendChild(row);
        });
      }

      function loadOrders2() {
        const orders = getCookie("orders");
        const tbody = document.querySelector("#orderTable2 tbody");
        tbody.innerHTML = "";
        orders.forEach((o, i) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${i + 1}</td>
            <td>${o.name}</td>
            <td>${o.qty}</td>
            <td>${o.date}</td>
            <td>${o.product}</td>
            <td>
              <button class="btn btn-sm btn-warning" onclick="editOrderInAdd(${i})">Edit</button>
              <button class="btn btn-sm btn-danger" onclick="deleteOrder(${i})">Delete</button>
            </td>
          `;
          tbody.appendChild(row);
        });
      }

      function loadDashboardOrders(orders) {
        const tbody = document.querySelector("#dashboardOrderTable tbody");
        tbody.innerHTML = "";
        orders.forEach((o, i) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${i + 1}</td>
            <td>${o.name}</td>
            <td>${o.qty}</td>
            <td>${o.date}</td>
            <td>${o.product}</td>
          `;
          tbody.appendChild(row);
        });
      }

      function editOrder(index) {
        const orders = getCookie("orders");
        if (index >= 0 && index < orders.length) {
          const o = orders[index];
          document.getElementById("orderName").value = o.name;
          document.getElementById("orderqty").value = o.qty;
          document.getElementById("orderDate").value = o.date;
          document.getElementById("orderProduct").value = o.product;
          document.getElementById("editOrderIndex").value = index;
          document.getElementById("orderBtn").textContent = "Update Order";
          showSection("addOrder");
        }
      }

      function editOrderInAdd(index) {
        editOrder(index);
      }

      function updateOrder(index) {
        let orders = getCookie("orders");
        if (index >= 0 && index < orders.length) {
          orders[index] = {
            name: document.getElementById("orderName").value,
            qty: parseInt(document.getElementById("orderqty").value, 10),
            date: document.getElementById("orderDate").value,
            product: document.getElementById("orderProduct").value
          };
          setCookie("orders", orders);
          alert("Order Updated");
          resetOrderForm();
          loadOrders();
          loadOrders2();
          loadDashboardOrders(orders);
          updateDashboardCounts(getCookie("products"), orders, getCookie("categories"), getCookie("users"));
        } else {
          alert("Invalid order index");
        }
      }

      function deleteOrder(index) {
        if (!confirm("Are you sure you want to delete this order?")) return;
        let orders = getCookie("orders");
        if (index >= 0 && index < orders.length) {
          orders.splice(index, 1);
          setCookie("orders", orders);
          loadOrders();
          loadOrders2();
          loadDashboardOrders(orders);
          updateDashboardCounts(getCookie("products"), orders, getCookie("categories"), getCookie("users"));
          alert("Order Deleted");
        } else {
          alert("Invalid order index");
        }
      }

      function resetOrderForm() {
        document.getElementById("editOrderIndex").value = "-1";
        document.getElementById("orderName").value = "";
        document.getElementById("orderqty").value = "";
        document.getElementById("orderDate").value = "";
        document.getElementById("orderProduct").value = "";
        document.getElementById("orderBtn").textContent = "Save Order";
      }

      // USER LOGIC
      function handleUserForm(event) {
        event.preventDefault();
        const idx = parseInt(document.getElementById("editUserIndex").value, 10);
        if (idx >= 0) updateUser(idx);
        else saveUser();
      }

      function saveUser() {
        let users = getCookie("users");
        const user = {
          name: document.getElementById("userName").value,
          email: document.getElementById("userEmail").value,
          phone: document.getElementById("userPhone").value
        };
        users.push(user);
        setCookie("users", users);
        alert("User Saved");
        resetUserForm();
        loadUsers();
        loadDashboardUsers(users);
        updateDashboardCounts(getCookie("products"), getCookie("orders"), getCookie("categories"), users);
      }

      function loadUsers() {
        const users = getCookie("users");
        const tbody = document.querySelector("#userTable tbody");
        tbody.innerHTML = "";
        users.forEach((u, i) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${i + 1}</td>
            <td>${u.name}</td>
            <td>${u.email}</td>
            <td>${u.phone || ""}</td>
            <td>
              <button class="btn btn-sm btn-warning" onclick="editUser(${i})">Edit</button>
              <button class="btn btn-sm btn-danger" onclick="deleteUser(${i})">Delete</button>
            </td>
          `;
          tbody.appendChild(row);
        });
      }

      function loadUsers2() {
        const users = getCookie("users");
        const tbody = document.querySelector("#userTable2 tbody");
        tbody.innerHTML = "";
        users.forEach((u, i) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${i + 1}</td>
            <td>${u.name}</td>
            <td>${u.email}</td>
            <td>${u.phone || ""}</td>
            <td>
              <button class="btn btn-sm btn-warning" onclick="editUserInAdd(${i})">Edit</button>
              <button class="btn btn-sm btn-danger" onclick="deleteUser(${i})">Delete</button>
            </td>
          `;
          tbody.appendChild(row);
        });
      }

      function loadDashboardUsers(users) {
        const tbody = document.querySelector("#dashboardUserTable tbody");
        tbody.innerHTML = "";
        users.forEach((u, i) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${i + 1}</td>
            <td>${u.name}</td>
            <td>${u.email}</td>
            <td>${u.phone || ""}</td>
          `;
          tbody.appendChild(row);
        });
      }

      function editUser(index) {
        const users = getCookie("users");
        if (index >= 0 && index < users.length) {
          const u = users[index];
          document.getElementById("userName").value = u.name;
          document.getElementById("userEmail").value = u.email;
          document.getElementById("userPhone").value = u.phone || "";
          document.getElementById("editUserIndex").value = index;
          document.getElementById("userBtn").textContent = "Update User";
          showSection("addUser");
        }
      }

      function editUserInAdd(index) {
        editUser(index);
      }

      function updateUser(index) {
        let users = getCookie("users");
        if (index >= 0 && index < users.length) {
          users[index] = {
            name: document.getElementById("userName").value,
            email: document.getElementById("userEmail").value,
            phone: document.getElementById("userPhone").value
          };
          setCookie("users", users);
          alert("User Updated");
          resetUserForm();
          loadUsers();
          loadUsers2();
          loadDashboardUsers(users);
          updateDashboardCounts(getCookie("products"), getCookie("orders"), getCookie("categories"), users);
        } else {
          alert("Invalid user index");
        }
      }

      function deleteUser(index) {
        if (!confirm("Are you sure you want to delete this user?")) return;
        let users = getCookie("users");
        if (index >= 0 && index < users.length) {
          users.splice(index, 1);
          setCookie("users", users);
          loadUsers();
          loadUsers2();
          loadDashboardUsers(users);
          updateDashboardCounts(getCookie("products"), getCookie("orders"), getCookie("categories"), users);
          alert("User Deleted");
        } else {
          alert("Invalid user index");
        }
      }

      function resetUserForm() {
        document.getElementById("editUserIndex").value = "-1";
        document.getElementById("userName").value = "";
        document.getElementById("userEmail").value = "";
        document.getElementById("userPhone").value = "";
        document.getElementById("userBtn").textContent = "Save User";
      }

      function updateDropdowns() {
        const categories = getCookie("categories");
        const products = getCookie("products");
        const categoryDropdown = document.getElementById("category");
        const productDropdown = document.getElementById("orderProduct");

        if (categoryDropdown) {
          categoryDropdown.innerHTML = '<option value="">Select Category</option>' + 
            categories.map(c => `<option value="${c}">${c}</option>`).join("");
        }
        if (productDropdown) {
          productDropdown.innerHTML = '<option value="">Select Product</option>' + 
            products.map(p => `<option value="${p.name}">${p.name}</option>`).join("");
        }
      }

      window.showSection = showSection;
      window.handleProductForm = handleProductForm;
      window.editProduct = editProduct;
      window.deleteProduct = deleteProduct;
      window.editProductInAdd = editProductInAdd;
      window.handleCategoryForm = handleCategoryForm;
      window.editCategory = editCategory;
      window.deleteCategory = deleteCategory;
      window.editCategoryInAdd = editCategoryInAdd;
      window.handleOrderForm = handleOrderForm;
      window.editOrder = editOrder;
      window.deleteOrder = deleteOrder;
      window.editOrderInAdd = editOrderInAdd;
      window.handleUserForm = handleUserForm;
      window.editUser = editUser;
      window.deleteUser = deleteUser;
      window.editUserInAdd = editUserInAdd;
    }));
  </script>
</body>
</html>